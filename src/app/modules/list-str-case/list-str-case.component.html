<form action="#">
  <!--begin::Card-->
  <div class="card mb-7">
    <!--begin::Card body-->
    <div class="card-body">
      <form cForm [formGroup]="searchForm" class="row m-1 g-2">
        <!--begin::Compact form-->
        <div class="">
          <!--begin::Input group-->
          <div class="row g-4 mb-2 d-flex align-items-center">
            <!--begin::Row-->
            <!-- <div class="row g-4"> -->
              <div class="col-lg-6">
                <label class="fs-6 form-label fw-bold text-gray-900"
                  >Ngày báo cáo</label
                >
                <div class="row">
                  <div class="col-lg-5">
                    <input
                      type="date"
                      class="form-control form-control-lg  mb-3 mb-lg-0"
                      placeholder="Ngày tạo"
                      name="fromDate"
                      formControlName="fromDate"
                    />
                  </div>
                  <div class="col-lg-1 position-relative">
                    <span class="position-absolute top-25 start-25">đến</span>
                  </div>

                  <div class="col-lg-5">
                    <input
                      type="date"
                      class="form-control form-control-lg  mb-3 mb-lg-0"
                      placeholder="Ngày đến"
                      name="toDate"
                      formControlName="toDate"
                    />
                  </div>
                </div>
              </div>
              
            <!-- </div> -->
            <!--begin: Mẫu STR -->
            <div class="col-lg-6">
              <!--begin::Row-->
              <div class="row g-4">
                <!--begin::Col-->
                <div class="col-lg-5">
                  <label class="fs-6 form-label fw-bold text-gray-900"
                    >Mẫu STR</label
                  >
                  <!--begin::Select-->
                  <select
                    class="form-select "
                    data-control="select2"
                    data-placeholder="In Progress"
                    data-hide-search="true"
                    name="strType"
                    formControlName="strType"
                  >
                    <option value="">
                      Tất cả
                    </option>

                    <option
                      *ngFor="
                        let str of strTypeList;
                        index as i;
                        first as isFirst
                      "
                      value="{{ str.code }}"
                    >
                      <span [id]=""> {{ str.name }}</span>
                    </option>
                  </select>
                  <!--end::Select-->
                </div>
                <!--end::Col-->
                <!--begin::Col-->
                <div class="col-lg-6">
                  <label class="fs-6 form-label fw-bold text-gray-900">
                    Mã số STR
                  </label>
                  <div class="me-md-2 position-relative">
                    <i
                      class="ki-duotone ki-magnifier fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6"
                    >
                      <span class="path1"></span>
                      <span class="path2"></span>
                    </i>
                    <input
                      type="text"
                      class="form-control  ps-10"
                      name="amldNumber"
                      formControlName="amldNumber"
                      [value]="searchForm.controls.amldNumber"
                      placeholder="Tìm theo Mã số STR"
                    />
                  </div>
                </div>
                <!--end::Col-->
              </div>
            </div>
            <!-- end: Mẫu STR -->
            
            <!--begin: Đối tượng báo cáo -->
            <div class="col-lg-6">
               <!--begin::Row-->
               <div class="row g-4">
                <!--begin::Col-->
                <div class="col-lg-11">
                    <label class="fs-6 form-label fw-bold text-gray-900">
                      Đối tượng báo cáo
                    </label>
                  <div class="me-md-2 position-relative">
                    
                    <select id="your-select-element" name="rptEntity" class="form-select "  formControlName="rptEntity" data-control="select2" data-placeholder="Tìm đối tượng báo cáo" >
                      <option value = "" ></option>
                      <option *ngFor="
                          let str of reportEntities;  
                          index as i;
                          first as isFirst" 
                          value="{{str.report_entity_code}}">{{str.report_entity_code}}-{{str.report_entity_name}}</option>
                    </select>
                  </div>
                </div>
               </div>
              
            </div>
            <!-- end: Đối tượng báo cáo  -->
            
            <!--begin: Trạng thái -->
            <div class="col-lg-6">
              <!--begin::Row-->
              <div class="row g-4">
                <!--begin::Col-->
                <div class="col-lg-11">
                  <label class="fs-6 form-label fw-bold text-gray-900">
                    Trạng thái
                  </label>
                  <div class="me-md-2 position-relative">
                    <select id="your-select-element-2" name="" class="form-select "  formControlName="" data-control="select2" data-placeholder="Trạng thái" multiple = "multiple">
                      <option *ngFor="
                          let str of statusList;  
                          index as i;
                          first as isFirst" 
                          value="{{str.code}}"  title="{{str.code}}">{{str.name}}</option>
                    </select>
                  </div>
                </div>
              </div>
              
            </div>
            <!-- end: trạng thái -->

            <!--begin: Số báo cáo -->
            <div class="col-lg-6">
               <!--begin::Row-->
               <div class="row g-4">
                <!--begin::Col-->
                <div class="col-lg-11">
                  <label class="fs-6 form-label fw-bold text-gray-900">
                    Số báo cáo
                  </label>
                  <div class="me-md-2 position-relative">
                    <i
                      class="ki-duotone ki-magnifier fs-3 text-gray-500 position-absolute top-50 translate-middle ms-6"
                    >
                      <span class="path1"></span>
                      <span class="path2"></span>
                    </i>
                    <input
                      type="text"
                      class="form-control  ps-10"
                      name="reportNo"
                      formControlName="reportNo"
                      [value]="searchForm.controls.reportNo"
                      placeholder="Tìm theo số báo cáo"
                    />
                  </div>
                </div>
               </div>
            </div>
            <!-- end: Số báo cáo  -->

            <!--begin: Nhận định về loại tội phạm -->
            <div class="col-lg-6">
              <!--begin::Row-->
              <div class="row g-4">
                <!--begin::Col-->
                <div class="col-lg-11">
                  <label class="fs-6 form-label fw-bold text-gray-900"
                    >Nhận định về loại tội phạm</label
                  >
                  <!--begin::Select-->
                  <select
                    class="form-select  form-control-sm "
                    data-placeholder="In Progress"
                    name="crime"
                    formControlName="crime"
                  >
                    <option value="">Tất cả </option>

                    <option
                      *ngFor="
                        let crime of crimes;
                        index as i;
                        first as isFirst
                      "
                      value="{{ crime.crimeCode }}"
                    >
                      <span [id]=""> {{ crime.crimeName }} </span>
                    </option>
                  </select>
                  <!--end::Select-->
                </div>
                <!--end::Col-->
              </div>
            </div>
            <!-- end: Nhận định về loại tội phạm -->

            <!--begin: Mức độ ưu tiên -->
            <div class="col-lg-6">
              <!--begin::Row-->
              <div class="row g-4">
                <!--begin::Col-->
                <div class="col-lg-11">
                  <label class="fs-6 form-label fw-bold text-gray-900"
                    >Mức độ ưu tiên</label
                  >
                  <!--begin::Select-->
                  <select
                    class="form-select "
                    data-placeholder="In Progress"
                    name="priority"
                    formControlName="priority"
                  >
                    <option value="">
                      Tất cả
                    </option>

                    <option
                      *ngFor="
                        let priority of priorityList;
                        index as i;
                        first as isFirst
                      "
                      value="{{ priority }}"
                    >
                      <span [id]=""> {{ priority }} </span>
                    </option>
                  </select>
                  <!--end::Select-->
                </div>
                <!--end::Col-->
              </div>
            </div>
            <!-- end: Mức độ ưu tiên -->

            <!--begin: Cán bộ xử lý -->
            <div class="col-lg-6">
              <!--begin::Row-->
              <div class="row g-4">
                <!--begin::Col-->
                <div class="col-lg-11">
                  <label class="fs-6 form-label fw-bold text-gray-900"
                    >Cán bộ xử lý</label
                  >
                  <!--begin::Select-->
                  <select
                    class="form-select "
                    data-placeholder="In Progress"
                    name="processor"
                    formControlName="processor"
                  >
                    <option value="">
                      Tất cả
                    </option>

                    <option
                      *ngFor="
                        let str of strUsers;
                        index as i;
                        first as isFirst
                      "
                      value="{{ str.email}}"
                    >
                      <span [id]=""> {{ str.name }} </span>
                    </option>
                  </select>
                  <!--end::Select-->
                </div>
                <!--end::Col-->
              </div>
            </div>
            <!-- end: Cán bộ xử lý -->

            <!--end::Row-->

            
          </div>
          <!--end::Input group-->
        </div>
        <!--end::Compact form-->

        <div class="row g-4 mb-2 mt-0 d-flex align-items-center">
          <!--begin::Col-->
          <div class="col-lg-7 g-4">
            <!--begin:Action-->
            <div class="d-flex align-items-center">
              <button
                type="submit"
                (click)="onSearch()"
                class="btn btn-primary me-5 mx-auto"
              >
                Tìm kiếm
              </button>
              
              <button type="button" (click)="clearSearch()"  class="btn btn-info me-5">
                Làm mới
              </button>
            </div>
            <!--end:Action-->
          </div>
          <!--end::Col-->
        </div>
      </form>
    </div>
    <!--end::Card body-->
  </div>
  <!--end::Card-->
</form>
<!--end::Search-->

<!-- begin::Header -->
<div class="card col-xl-12 mb-5 mb-xl-8">
  <div class="card-header align-items-center gap-2 gap-md-5">
    <!--begin::Card title-->
    <span *ngIf="isLoading" class="btn text-gray-500">
      Đang làm mới thông tin</span
    >
    <!--end::Card title-->
    <!--begin::Card toolbar-->
    <div class="card-toolbar flex-row-fluid justify-content-start gap-5">
      <!-- <div class="w-100 mw-150px"> -->
        <!--begin::Select2-->
        <!-- <select
          class="form-select form-select-solid"
          data-control="select2"
          data-hide-search="true"
          data-placeholder="Status"
          data-kt-ecommerce-product-filter="status"
        >
          <option disabled>Sắp xếp</option>
          <option value="latest" selected>Mới cập nhật</option>
          <option value="newest" selected>Mới nhất</option>
          <option value="published">Cũ nhất</option>
        </select> -->
        <!--end::Select2-->
      <!-- </div> -->
      <a
      *ngIf="  hasVisibleBtnChangeProcessors()"
        (click)="onChangeProcessors()" 
        class="btn btn-light-primary"
      >
        Thay đổi CB xử lý
      </a>

      <!-- <a
        *ngIf="hasVisibleBtnAddNew()"
        routerLink="/report-str/report-two"
        class="btn btn-light-primary"
      >
        Thêm mới STR
      </a> -->
    </div>
  </div>

  <!-- end::Header -->
  <!-- begin::Body -->
  <div class="card-body py-3">
    <!-- begin::Table container -->
    <div class="card-body pt-0 overflow-auto position-relative">
      <!-- <app-crud [datatableConfig]="datatableConfig" route="/apps/users" (deleteEvent)="delete($event)" (editEvent)="edit($event)" (createEvent)="create()" [reload]="reloadEvent" [modal]="formModal"></app-crud> -->
      <table
        class="table align-middle table-row-dashed fs-6 gy-5"
        id="kt_ecommerce_products_table"
      >
        <thead>
          <tr
            class="text-start text-gray-500 fw-bold fs-7 text-uppercase text-end pe-0 "
          >
            <th class="w-10px text-end pe-0">
              <div
                class="form-check form-check-sm form-check-custom form-check-solid me-3"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  data-kt-check="true"
                  data-kt-check-target="#kt_ecommerce_products_table .form-check-input"
                  [checked]="selectAllCheckbox"
                  (click)="onToggleAllCheckbox()"
                />
              </div>
            </th>
            <th class="text-wrap text-center min-w-100px">Ngày báo cáo</th>
            <th class="text-wrap text-center min-w-80px">Mẫu STR</th>
            <th class="text-wrap text-center min-w-100px">Mã ĐTBC</th>
            <th class="text-wrap text-center min-w-120px">Tên ĐTBC</th>
            <th class="text-wrap text-center min-w-80px">Số báo cáo</th>
            <th class="text-wrap text-center min-w-100px">Mã số STR</th>
            <th class="text-wrap text-center min-w-100px">Thời gian chờ phản hồi</th>
            <th class="text-wrap text-center min-w-100px">Nhận định về loại tội phạm</th>
            <th class="text-wrap text-center min-w-100px">Mức độ ưu tiên</th>
            <th class="text-wrap text-center min-w-100px">Điểm trọng số</th>
            <th class="text-wrap text-center min-w-100px">Cán bộ xử lý</th>
            <th class="text-wrap text-center min-w-100px">Trạng thái</th>
            <th class="text-wrap text-center min-w-100px">Ngày phản hồi ĐTBC</th>
            <th class="text-wrap text-center min-w-100px"></th>
          </tr>
        </thead>

        <tbody
          class="fw-semibold text-gray-800"
          *ngFor="
            let record of searchResultData?.records;
            index as i;
            first as isFirst
          "
        >
          <tr id="{{ i }}">
            <td>
              <div
                class="form-check form-check-sm form-check-custom form-check-solid"
              >
                <input class="form-check-input" type="checkbox" value="{{record?.id}}" (change)="onCheckboxChange($event, record.id)" [checked]="selectAllCheckbox"/>
              </div>
            </td>
            

            <!-- Ngày báo cáo -->
            <td class="text-wrap pe-0" >
              <span class="fw-bold ms-3 badge badge-light-success">
                {{record?.ngay_bao_cao | date : "dd/MM/yyyy"}}</span>
            </td>

            <!-- Mẫu STR -->
            <td class="text-center pe-0 fw-bold  ">
              {{getParseSTRType(record?.str_type) ?? "" }}
            </td>

            <!-- Mã ĐTBC -->
            <td class="text-center pe-0">
              {{ record?.report_entity_code ?? "" }}
            </td>
            <!-- Tên ĐTBC -->
            <td class="text-end pe-0">
              {{ record?.report_entity_name ?? "" }}
            </td>
            <!-- Số báo cáo -->
            <td class="text-center pe-0" >
              <span class="fw-bold ms-3 badge badge-light-primary">{{
                record?.so_bao_cao ?? ""
              }}</span>
            </td>
            <!-- Mã số STR -->
            <td class="text-center pe-0" >
              <span class="fw-bold ms-3">{{
                record?.amld_internal_number ?? ""
              }}</span>
            </td>
            <!-- Thời gian chờ phản hồi -->
            <td class="text-center pe-0" >
              <span class=" ms-3">{{
                record?.response_time ?? ""
              }}</span>
            </td>
            <!-- Nhận định về loại tội phạm -->
            <td class="text-wrap pe-0 ">
              <span title= "{{ getParseSTRKetLuan(record?.ket_luan) }}" class="d-inline-block text-truncate" style="max-width: 100px;">
                {{getParseSTRKetLuan(record?.ket_luan).length >30 
                    ? getParseSTRKetLuan(record?.ket_luan).substring(0, 30) + '...' 
                    : getParseSTRKetLuan(record?.ket_luan)}}
              </span>
            </td>
            <!-- Mức độ ưu tiên -->
            <td class="text-center pe-0">
              {{ record?.priority ?? "" }}
            </td>
            <!-- Điểm trọng số -->
            <td class="text-center pe-0">
              {{ record?.point ?? "" }}
            </td>
            <!-- Cán bộ xử lý -->
            <td class="text-end pe-0">
              {{ getParseStrUser(record?.received_by) }}
            </td>
            <!-- Trạng thái -->
            <td class="text-end pe-0" >
              <!--begin::Badges-->
              <div class="badge badge-light-info">
                <!-- {{ record?.reception_status ?? "N/A" }} -->
                {{ getParseSTRStatus(record?.reception_status ?? "") }}
              </div>
              <!--end::Badges-->
            </td>

            <!-- Ngày phản hồi ĐTBC -->
            <td class="text-center pe-0" >
              <div *ngIf="record?.received_at" class="badge badge-light-danger">
                {{ record?.received_at | date : "dd/MM/yyyy" }}
              </div>
            </td>
            <!-- Xem chi tiết -->
           
            <td class="text-end">
              <div
                id="kt_record_menu-{{ record?.id }}"
                class="kt_record_menu btn btn-sm btn-light btn-flex btn-center btn-active-light-primary {{
                  this.recordActiveIndex == i ? 'show' : ''
                }}"
                data-kt-menu-trigger="click"
                data-kt-menu-placement="right-end"
                (click)="toggleRecordActive(i)"
              >
                Thao tác <i class="ki-duotone ki-down fs-5 ms-1"></i>
              </div>
              <!--begin::Menu-->
              <div
                class="{{
                  this.recordActiveIndex == i ? 'show absolute ' : ''
                }} menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4"
                data-kt-menu="true"
              >
                <!--begin::Menu item-->
                  <div *ngIf="hasVisibleBtnEdit(record)" class="menu-item px-3">
                    <div (click)="onUpdateSTR(record)" class="menu-link px-3">
                      Cập nhật STR
                    </div>
                  </div>

                  <div *ngIf=" hasVisibleBtnView(record)" class="menu-item px-3">
                    <div (click)="onPreview(record)" class="menu-link px-3">
                      Xem chi tiết
                    </div>
                  </div>
                <!--end::Menu item-->

                <div class="menu-item px-3"></div>
                <!--end::Menu item-->
              </div>
              <!--end::Menu-->
              

            </td>
          </tr>
        </tbody>
      </table>
      <!--begin::Pagination-->
      <div class="d-flex flex-stack flex-wrap pt-10">
        <div *ngIf="searchResultData?.pageInfo?.totalRecord > 0" class="fs-6 fw-semibold text-gray-700">
          Đang hiển thị
            {{
              searchResultData?.pageInfo?.pageIndex *
                searchResultData?.pageInfo?.pageSize +
                1
            }}
            đến
            {{
              (searchResultData?.pageInfo?.pageIndex + 1) *
                searchResultData?.pageInfo?.pageSize
            }}
            của {{ searchResultData?.pageInfo?.totalRecord }} dòng.
        </div>
        <div *ngIf="searchResultData?.pageInfo?.totalRecord == 0" class="fs-6 fw-semibold text-gray-700">
          Không có dữ liệu.
        </div>

        <!--begin::Pages-->
        <ul class="pagination">
          <li *ngIf="this.pageIndex - 1 >= 0" class="page-item previous">
            <a
              (click)="changePage(this.pageIndex - 1)"
              class="page-link cursor-pointer"
            >
              <i class="previous"></i>
            </a>
          </li>

          <li class="page-item active">
            <a class="page-link cursor-pointer">{{ this.pageIndex + 1 }}</a>
          </li>

          <li
            *ngIf="this.pageIndex + 1 < totalPage"
            class="page-item cursor-pointer"
          >
            <a (click)="changePage(this.pageIndex + 1)" class="page-link">{{
              this.pageIndex + 2
            }}</a>
          </li>

          <li *ngIf="this.pageIndex + 2 < totalPage" class="page-item next">
            <a
              (click)="changePage(this.pageIndex + 2)"
              class="page-link cursor-pointer"
            >
              <i class="next"></i>
            </a>
          </li>
        </ul>

        <!--end::Pages-->
      </div>
      <!-- end::Table container -->
    </div>
  </div>
  <!-- begin::Body -->
</div>
